function loadSearchBarTextInput(){const e=sessionStorage.getItem("states");if(!e)return;const t=JSON.parse(e);if(t.rawSearch){const e=document.getElementById("searchInput"),a=document.getElementById("searchInputMobile");e&&(e.value=t.rawSearch),a&&(a.value=t.rawSearch)}}function formatRange(e,t){if(!e)return"";if(!t)return"";let a="",n=1;t>=1e9?(a="B",n=1e9):t>=1e6?(a="M",n=1e6):t>=1e3&&(a="k",n=1e3);let s,r=Math.floor(t/n*100)/100+a;return e===t?`${r}`:(s=e>=1e3&&e<1e6?Math.floor(e/1e3*100)/100:e>=1e6&&e<1e9?Math.floor(e/1e6*100)/100:e>=1e9?Math.floor(e/1e9*100)/100:e,`${s}-${r}`)}window.addEventListener("DOMContentLoaded",()=>{loadSearchBarTextInput()});let allCategories=[],categoryReleaseDateMap=[],categoryDiscontinuedDateMap=[];function setupCategories(e){allCategories=e,categoryReleaseDateMap=new Map(allCategories.map(e=>[e.id,e.release_date])),categoryDiscontinuedDateMap=new Map(allCategories.map(e=>[e.id,e.discontinued_date]));document.getElementById("collectionRadios")}function renderItems(e,t){e.innerHTML="",t.forEach(t=>{let a;if(t.on_sale){const e="Gold"===t.currency_type;a=`<div class="w-full text-center pt-2">\n        <span class="inline-flex items-center ${e?"text-orange-400":"text-gray-500"} text-base">\n          <img src="${e?"/assets/gold_icon.png":"/assets/credits_icon.png"}" class="w-8 h-8 mr-1 inline" alt="${t.currency_type}">\n          ${t.original_price.toLocaleString()}\n        </span>\n      </div>`}else if(null!=t.min_value&&null!=t.max_value){let e=formatRange(t.min_value,t.max_value);t.ultra_rare&&t.min_value===t.max_value&&(e+="+"),a=`<div class="w-full text-center pt-2">\n        <span class="text-gray-500 text-base">\n          ${e}\n        </span>\n      </div>`}else a='<div class="w-full text-center pt-2">\n        <span class="text-gray-500 text-base invisible">placeholder</span>\n      </div>';const n=document.createElement("a");n.href="/item/?id="+t.id,n.className="block";const s=document.createElement("div");s.className="bg-gray-100 rounded-lg p-3 shadow hover:shadow-lg transform transition-transform duration-100 hover:-translate-y-1 cursor-pointer flex flex-col justify-between items-center h-64 w-full max-w-xs",s.innerHTML=`\n      <div class="w-full text-center font-semibold text-gray-700 truncate">\n        ${t.name}\n      </div>\n\n      <img src="${t.image_url}" alt="${t.name}"\n           class="card-image w-32 h-36 object-contain rounded my-2">\n\n      ${a}\n    `,n.appendChild(s);s.querySelector(".card-image").addEventListener("dragstart",e=>e.preventDefault()),e.appendChild(n)})}function preCalculateItemDates(e){e.forEach(e=>{e.forEach(e=>{const t=categoryReleaseDateMap.get(e.category),a=categoryDiscontinuedDateMap.get(e.category);e.release_date||(e.release_date=t||"1900-01-01"),!e.discontinued_date&&a&&(e.discontinued_date=a)})})}function isItemForSale(e){if(!e.discontinued_date)return!0;const t=new Date;return new Date(e.discontinued_date)>t}function preCalculateItemOnSales(e){e.forEach(e=>{e.forEach(e=>{e.on_sale=isItemForSale(e)})})}async function fetchData(){try{const e=await fetch("https://ihqgfedofjqucmeerbua.supabase.co/functions/v1/get-home",{method:"GET",headers:{"x-api-key":"827f3a6abb3e26bd0cd0c1cba37bb73cf0099a9de2cb4f367586d848a4513306"}});if(!e.ok){const t=await e.text();return console.warn("Request failed:",e.status,t),null}const t=await e.json(),{categories:a,mostValuableItems:n,recentItems:s,randomItems:r}=t||{};return{categories:a,mostValuableItems:n,recentItems:s,randomItems:r}}catch(e){return console.error("Fetch failed:",e),alert("An error occurred. Please refresh to continue."),null}}async function init(){window.addEventListener("DOMContentLoaded",()=>{});const e=document.getElementById("loadingSpinner"),t=document.getElementById("mostValuableContainer"),a=document.getElementById("recentlyAddedContainer"),n=document.getElementById("dailyRandomsContainer");e.classList.remove("hidden"),t.classList.add("hidden"),a.classList.add("hidden"),n.classList.add("hidden");const{categories:s,mostValuableItems:r,recentItems:o,randomItems:c}=await fetchData();setupCategories(s),preCalculateItemDates([r,o,c]),preCalculateItemOnSales([r,o,c]),renderItems(t,r),renderItems(a,o),renderItems(n,c),e.classList.add("hidden"),t.classList.remove("hidden"),a.classList.remove("hidden"),n.classList.remove("hidden")}function handleSearchInputClicked(){sessionStorage.setItem("focusSearch","1"),window.location.href="/catalog/"}document.getElementById("mostValuableViewAllButton").addEventListener("click",()=>{sessionStorage.setItem("states",JSON.stringify({collection:"All",sort:"price",order:"descending",search:"",rawSearch:"",page:1})),window.location.href="/catalog/"}),document.getElementById("recentlyAddedViewAllButton").addEventListener("click",()=>{sessionStorage.setItem("states",JSON.stringify({collection:"All",sort:"release_date",order:"descending",search:"",rawSearch:"",page:1})),window.location.href="/catalog/"}),document.getElementById("dailyRandomsViewAllButton").addEventListener("click",()=>{sessionStorage.setItem("states",JSON.stringify({})),window.location.href="/catalog/"}),init();const desktopSearchInput=document.getElementById("searchInput"),mobileSearchInput=document.getElementById("searchInputMobile");desktopSearchInput&&desktopSearchInput.addEventListener("click",handleSearchInputClicked),mobileSearchInput&&mobileSearchInput.addEventListener("click",handleSearchInputClicked);